{% extends 'base.html' %}
{% block content %}

<div class="layout-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <i class="fas fa-utensils"></i>
      <h1>Foodmate</h1>
    </div>
    <ul class="nav-links">
      <li class="active"><a href="/restaurant_dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
      <li><a href="/profile"><i class="fas fa-user"></i> Profile</a></li>
      <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </aside>

  <main class="dashboard-main">
    <h2>Welcome, {{ session['user'] }}</h2>

    <!-- Restaurant Info -->
    <div class="card highlight-card">
      <h3>Restaurant: {{ restaurant_name }}</h3>
    </div>

    <!-- Summary cards -->
    <div class="summary-container">
      <div class="summary-card">
        <h4>Total Posts</h4>
        <p>{{ total_posts }}</p>
      </div>
      <div class="summary-card">
        <h4>Total Likes</h4>
        <p>{{ total_likes }}</p>
      </div>
      <div class="summary-card">
        <h4>Total Comments</h4>
        <p>{{ total_comments }}</p>
      </div>
    </div>

    <!-- Quality Score -->
    <div class="card">
      <h3>Quality Score</h3>
      {% if restaurant_score %}
        <div class="score-stars">
          {% set score = restaurant_score | round(0, 'floor') %}
          {% for i in range(1, 6) %}
            {% if i <= score %}
              <span style="color: gold;">★</span>
            {% else %}
              <span style="color: lightgray;">★</span>
            {% endif %}
          {% endfor %}
          <strong style="margin-left: 10px;">{{ restaurant_score }} / 5</strong>
        </div>
      {% else %}
        <p>No data available to compute score.</p>
      {% endif %}
    </div>

    <!-- Sentiment Chart -->
    <div class="card">
      <h3>Customer Sentiment</h3>
      <canvas id="sentimentChart" height="100"></canvas>
    </div>
  </main>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('sentimentChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Positive', 'Neutral', 'Negative'],
      datasets: [{
        label: 'Sentiment',
        data: [
           sentiment_counts['Positive'] || 0,
           sentiment_counts['Neutral'] || 0,
           sentiment_counts['Negative'] || 0
        ],
        backgroundColor: ['#4caf50', '#ffca28', '#f44336'],
        borderRadius: 6,
        barThickness: 40
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
</script>

<!-- Styling -->
<style>
  .dashboard-main {
    padding: 2rem;
    background: #f0f2f5;
    flex: 1;
  }
  .card {
    background: white;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .highlight-card {
    background: #e1f5fe;
    color: #0277bd;
  }
  .summary-container {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  .summary-card {
    flex: 1;
    background: #fffde7;
    border-left: 6px solid #ffeb3b;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .score-stars {
    font-size: 1.5rem;
  }
</style>

{% endblock %}
