{% extends 'base.html' %}
{% block content %}

<div class="layout-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <i class="fas fa-utensils"></i>
      <h1>Foodmate</h1>
    </div>
    <ul class="nav-links">
      {% if session['role'] == 'owner' %}
      <li><a href="/restaurant_dashboard" class="active"><i class="fas fa-chart-line"></i> Restaurant Dashboard</a></li>
      {% endif %}
      {% if session['role'] != 'owner' %}
      <li class="active"><a href="/dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
      <li><a href="/feed"><i class="fas fa-rss"></i> Feed</a></li>
      <li><a href="/upload"><i class="fas fa-plus"></i> Upload</a></li>
      {% endif %}
      <li><a href="/profile"><i class="fas fa-user"></i> Profile</a></li>
      <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="dashboard-main">
    <header class="dash-header">
      <div>
        <h2 class ="heading">Dashboard</h2>
        <p class="sub-heading">Modern food review platform with social features</p>
      </div>
      <a href="/upload" class="new-post-btn"><i class="fas fa-plus"></i> New Post</a>
    </header>
    <div class="dashboard-trending">
      <h3 class="textColur">üîù Trending Tags</h3>
      <ul id="trendingList" class="textColur">
        <li>Loading...</li>
      </ul>
    </div>
     
    <!-- Recent Posts -->
    <section class="recent-posts">
      <h3 class ="heading">Recent Posts</h3>
      <div class="post-list">
        {% for post in sample_posts %}
        <a style="text-decoration: none; color: inherit;" href="/post/{{ post._id }}">
          <div class="feed-post-wrapper"> 
          <div class="post-item">
            <img class="image" src="data:image/jpeg;base64,{{ post.image_base64 }}" alt="Food Image" >
             
            <div class="post-content">
              <h4>{{ post.review }}</h4>
              <p class="tag">üç¥ {{ post.predicted_tag }}</p>
              <p class="username">Posted by: <span class="user-highlight">{{ post.username }}</span></p>
              <!-- <p class="meta">
                <i class="fas fa-heart"></i> {{ post.likes | length if post.likes }} &nbsp;
                <i class="fas fa-comment"></i> {{ post.comments | length if post.comments }}
              </p> -->
              {% if post.promoted %}
            <span class="promoted-label">‚≠ê Promoted Post</span>
            {% endif %}
            <div class="meta-info">
              <form action="/like_post/{{ post._id }}" method="POST" style="display:inline;"
                onclick="event.stopPropagation();">
                <button type="submit" class="reaction-btn" title="Like">üëç
                  <span>{{ post.likes|length if post.likes }}</span>
                </button>
              </form>
              <form action="/dislike_post/{{ post._id }}" method="POST" style="display:inline;"
                onclick="event.stopPropagation();">
                <button type="submit" class="reaction-btn" title="Dislike">üëé
                  <span>{{ post.dislikes|length if post.dislikes }}</span>
                </button>
              </form>
              <i class="fa-solid fa-comment" style="color: #ff7043;"></i> {{ post.comments|length if post.comments }}
            </div>
            </div>
          </div>
          </div>
        </a>
        {% endfor %}
      </div>
    </section>
  </main>
</div>
<script>
  fetch('/trending_tags')
    .then(response => response.json())
    .then(tags => {
      const list = document.getElementById('trendingList');
      list.innerHTML = ''; // Clear "Loading..."
      tags.forEach(([tag, count]) => {
        const item = document.createElement('li');
        item.textContent = `üçΩ ${tag}`;
        list.appendChild(item);
      });
    })
    .catch(err => {
      document.getElementById('trendingList').innerHTML = '<li>Error loading tags</li>';
      console.error(err);
    });
</script>

{% endblock %}